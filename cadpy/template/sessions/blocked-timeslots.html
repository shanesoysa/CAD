{% extends 'base.html' %}

{% block title %}Blocking Sessions{% endblock title %}

{% block stylesheet %}{% endblock stylesheet %}

{% block content %}
<div class="container-fluid main bg-white">
    <div class="bg-light" style="padding: 10px 0px; font-weight: 900;">
        <h3 style="color: #33344a;" >Block Timeslots </h3>
    </div>
    <div>
        <form onsubmit="methods()">
            <div class="form-check form-check-inline">
                <input type="radio" class="form-check-input" name="block_name" id="lecturer" value="L" checked="true"/>
                <label class="form-check-label" for="lecturer">Lecturer</label>
            </div>
            <div class="form-check form-check-inline">
                <input type="radio" class="form-check-input" name="block_name" id="group" value="G"/>
                <label class="form-check-label" for="group">Group</label>
            </div>
            <div class="form-check form-check-inline">
                <input type="radio" class="form-check-input" name="block_name" id="subgroup" value="S"/>
                <label class="form-check-label" for="subgroup">Subgroup</label>
            </div>
            <div class="col-6 form-check form-check-inline changegroup">
                <select id="blockId" class="form-control selectpicker" data-live-search="true" name="group">
                    <option value="default" disabled selected>Select </option>
                        {% for lecturer in lecturer_list %}
                        <option value="{{lecturer.id}}">{{ lecturer.employee_id }} - {{ lecturer.name }}</option>
                        {% endfor %}
                </select>
            </div>
            <input type="submit" value="Select Time" />
        </form>
    </div>
</div>
{% endblock content %}

{% block javascript%}
<script>
$(document).ready(function(){

    $('input[type="radio"][name="block_name"]').change(function(){
        var name = $('input[name="block_name"]:checked').val();
        $.ajax({
            url: '{% url "get_group_data_2" %}',
            data: {
                group_type: name
            },
            dataType: 'json',
            success: function(data){
                if(data.groups){
                    console.log(data.groups)
                    $('#blockId').empty();
                    $('#blockId').append($("<option></option>")
                    .attr({
                        "value": "default",
                        "selected": "true",
                        "disabled": "true"
                    }).text('Select'));
                    makeDropdownChange(data.groups, data.group_type);
                }else{
                    alert('unexpected error')
                }
            }
        });
    });

    function makeDropdownChange(groups, group_type){
        if(group_type == 'group'){
            $.each(groups, function(index, value){
                $('#blockId').append($("<option></option>").attr("value", value.id).text(value.generated_group));
            });
            $('#blockId').selectpicker('refresh');

        }else if(group_type == 'subgroup'){
            $.each(groups, function(index, value){
                $('#blockId').append($("<option></option>").attr("value", value.id).text(value.generated_subgroup));
            });
            $('#blockId').selectpicker('refresh');
        }else{
            $.each(groups, function(index, value){
                $('#blockId').append($("<option></option>").attr("value", value.id).text(value.employee_id + ' - ' + value.name));
            });
            $('#blockId').selectpicker('refresh');            
        }
    }
});
</script>
{% endblock javascript %}

